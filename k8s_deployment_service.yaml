steps:
# Paso 1: Hacer checkout del código
- task: Checkout@1
  displayName: 'Checkout code'

# Paso 2: Configurar AWS CLI
- task: AWSCLI@1
  inputs:
    awsCredentials: 'AWS-EKS-Connection'  # Asegúrate de que el nombre coincida exactamente con la conexión de servicio
    regionName: 'us-west-2'  # Reemplaza con la región de tu EKS

# Paso 3: Configurar kubectl para interactuar con EKS
- script: |
    aws eks --region us-west-2 update-kubeconfig --name my-cluster  # Reemplaza 'my-cluster' con tu clúster EKS
  displayName: 'Configure kubectl for EKS'

# Paso 4: Desplegar en Kubernetes usando el archivo YAML
- task: Kubernetes@1
  inputs:
    connectionType: 'Kubernetes Service Connection'
    kubernetesServiceEndpoint: 'AWS-EKS-Connection'  # Asegúrate de que el nombre coincida exactamente con la conexión de servicio
    command: 'apply'
    arguments: '-f k8s_deployment_service.yaml'  # Ruta a tu archivo YAML de Kubernetes
  displayName: 'Deploy to EKS'